package template

type {{ .TagStructName }}{{ .TyVarsWithType }} struct {
	{{ .Fields }}
}

func {{ .TagName }}{{ .TyVarsWithType }}({{ .Params }}) {{ .DataName }}{{ .TyVars }} {
	return &{{ .TagStructName }}{{ .TyVars }}{
		{{ .KeyValuePairs }}
	}
}

func (x *{{ .TagStructName }}{{ .TyVars }}) Maybe() *{{ .MatcherStructName }}{{ .TyVars }} {
	return &{{ .MatcherStructName }}{{ .TyVars }}{x: x}
}

func (x *{{ .MatcherStructName }}{{ .TyVars }}) {{ .TagName }}() *{{ .MaybeTagStructName }}{{ .TyVars }} {
	if y, ok := x.x.(*{{ .TagStructName }}{{ .TyVars }}); ok {
		return &{{ .MaybeTagStructName }}{{ .TyVars }}{x: y}
	}
	return &{{ .MaybeTagStructName }}{{ .TyVars }}{}
}

type {{ .MaybeTagStructName }}{{ .TyVarsWithType }} struct {
	x *{{ .TagStructName }}{{ .TyVars }}
}

func (x *{{ .MaybeTagStructName }}{{ .TyVars }}) OK() bool {
	return x.x != nil
}

{{ if .HasFields }}
func (x *{{ .MaybeTagStructName }}{{ .TyVars }}) Fields() ({{ .Params }}, ok bool) {
	if !x.OK() {
		return
	}
	return {{ .FieldsMethodReturn }}, true
}
{{ end }}
